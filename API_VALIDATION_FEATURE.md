# API Key Validation Feature

## Overview

The `create-storentia` CLI now includes **automatic API key validation** to ensure that only valid Storentia authentication keys can be used to create new stores. This feature validates your API key against the Storentia backend before proceeding with store creation.

## How It Works

### 1. User Input
When you run `npm create storentia@latest`, the CLI will prompt you for:
- **Store Name**: The name of your new store
- **Authentication Key**: Your Storentia API key (format: `sk_prod_...`)

### 2. API Validation
After you enter your authentication key, the CLI automatically:
1. Sends a validation request to `https://storekit.samarthh.me/v1/auth/key/validate`
2. Verifies that the key is valid and active
3. Retrieves your store information from the API

### 3. Validation Response
If the key is **valid**, you'll see:
```
ğŸ” Validating your authentication key...
âœ… Authentication successful!

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š Store Information:
  â€¢ Store Name: test store
  â€¢ Store ID: 20dc50db-b623-4076-85df-c6d2eec70992
  â€¢ Owner: samridh satnalika
  â€¢ Key Type: PROD
  â€¢ Permissions: READ, WRITE, MANAGE_PRODUCTS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

If the key is **invalid**, you'll see:
```
ğŸ” Validating your authentication key...
âŒ Authentication failed: Invalid API key
Please check your API key and try again.
```

## What Data Is Retrieved

When your API key is validated, the following information is automatically retrieved and saved to your environment files:

### Store Information
- **Store ID**: Unique identifier for your store
- **Store Name**: The name of your store from the API
- **Store Description**: Optional description of your store
- **Created At**: When the store was created
- **Updated At**: Last update timestamp

### Owner Information
- **Owner ID**: Unique identifier for the store owner
- **Owner Name**: Full name of the store owner
- **Owner Email**: Email address of the store owner
- **Owner Role**: Role in the system (e.g., USER, ADMIN)

### API Key Information
- **Key ID**: Unique identifier for the API key
- **Key Type**: Type of key (PROD, DEV, TEST)
- **Permissions**: Array of permissions (e.g., READ, WRITE, MANAGE_PRODUCTS)
- **Metadata**: Additional key metadata (e.g., description)

## Environment Files

All validated data is automatically saved to your environment files:

### `.env.local` (Main Store)
```env
# Storentia Main Store Configuration
# Generated on 2025-12-11T13:53:52.000Z

# Authentication Key
STORENTIA_AUTH=sk_prod_gGBtannC3LcP76L3QIlmxLkyWpDuCuDnJfB9095je-I

# Store Information (from validated API response)
NEXT_PUBLIC_STORE_ID=20dc50db-b623-4076-85df-c6d2eec70992
NEXT_PUBLIC_STORE_NAME=test store
NEXT_PUBLIC_STORE_DESCRIPTION=

# Store Owner Information
STORE_OWNER_ID=baf3efe6-29e5-40a2-94b5-2469db6b2d6c
STORE_OWNER_NAME=samridh satnalika
STORE_OWNER_EMAIL=samridhsatnalika790@gmail.com

# API Key Information
API_KEY_TYPE=PROD
API_KEY_PERMISSIONS=READ,WRITE,MANAGE_PRODUCTS

# API Configuration
NEXT_PUBLIC_API_URL=https://storekit.samarthh.me/v1
```

### `.env.dashboard` (Admin Dashboard)
Same structure as `.env.local` with additional dashboard-specific variables:
```env
NEXT_PUBLIC_DASHBOARD_MODE=true
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=<auto-generated-secret>
```

## Error Handling

The CLI handles various error scenarios:

### Invalid API Key
```
âŒ Authentication failed: Invalid API key
Please check your API key and try again.
```

### Network Errors
```
âŒ Authentication failed: API validation failed: getaddrinfo ENOTFOUND
Please check your internet connection and try again.
```

### Empty API Key
```
âŒ Error: Authentication key cannot be empty!
```

## Security Considerations

### âœ… What We Do
- Validate keys against the official Storentia API
- Use HTTPS for all API requests
- Store keys securely in `.env.local` and `.env.dashboard`
- Automatically add environment files to `.gitignore`
- Never log or display full API keys in console output

### âš ï¸ What You Should Do
- **Never commit** `.env.local` or `.env.dashboard` to version control
- **Keep your API keys secure** and don't share them
- **Rotate keys regularly** if you suspect they've been compromised
- **Use production keys** (`sk_prod_...`) only in production environments

## API Endpoint

The validation uses the following endpoint:
```
GET https://storekit.samarthh.me/v1/auth/key/validate?key={your_api_key}
```

### Response Format
```json
{
  "success": true,
  "message": "API key is valid",
  "store_data": {
    "keyId": "cc6eda32-926e-4acb-a181-c2f80ee62332",
    "storeId": "20dc50db-b623-4076-85df-c6d2eec70992",
    "store": {
      "id": "20dc50db-b623-4076-85df-c6d2eec70992",
      "name": "test store",
      "description": "",
      "ownerId": "baf3efe6-29e5-40a2-94b5-2469db6b2d6c",
      "createdAt": "2025-12-09T19:08:38.873Z",
      "updatedAt": "2025-12-09T19:08:38.873Z",
      "owner": {
        "id": "baf3efe6-29e5-40a2-94b5-2469db6b2d6c",
        "name": "samridh satnalika",
        "email": "samridhsatnalika790@gmail.com",
        "role": "USER"
      }
    },
    "permissions": ["READ", "WRITE", "MANAGE_PRODUCTS"],
    "type": "PROD",
    "metadata": {
      "description": "Key for CI/CD pipeline"
    }
  }
}
```

## Getting Your API Key

1. Visit [https://storekit.samarthh.me](https://storekit.samarthh.me)
2. Sign in or create an account
3. Navigate to your store settings
4. Generate a new API key
5. Copy the key (format: `sk_prod_...`)
6. Use it when running `npm create storentia@latest`

## Troubleshooting

### "API validation failed: getaddrinfo ENOTFOUND"
- **Cause**: No internet connection or DNS issues
- **Solution**: Check your internet connection and try again

### "Invalid API key"
- **Cause**: The key is incorrect, expired, or revoked
- **Solution**: Generate a new key from the Storentia dashboard

### "Authentication key cannot be empty"
- **Cause**: No key was entered
- **Solution**: Enter a valid API key when prompted

## Version History

### v1.1.0 (Current)
- âœ¨ Added automatic API key validation
- âœ¨ Auto-populate environment files with store data
- âœ¨ Display store information after successful validation
- âœ¨ Enhanced error handling and user feedback

### v1.0.3 (Previous)
- Basic CLI functionality without API validation
- Manual environment file configuration

## Support

If you encounter any issues with API key validation:
1. Check that your API key is valid and active
2. Ensure you have a stable internet connection
3. Verify the API endpoint is accessible
4. Contact support at [support@techsolace.co](mailto:support@techsolace.co)
